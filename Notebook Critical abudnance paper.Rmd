---
title: "Critical abundance paper"
output: html_notebook
---

Analyses of the critical abundances for the impact of non-native plants on native grassland plant communities of Banks peninsula.

```{r setup, echo=FALSE}

# load packages
library(doBy)
library(vegan)
library(markdown)
require(rgdal)
require(rgeos)
require(raster)
require(sp)
require(maps)
library(raster)
library(prettymapr)
library(maptools)

# For a quick output without re-running the analyses
# load("saved Rdata/article 2 - threshold/article threshold 1.3.4.Rdata") 

```

# Data importation

The full raw dataset is only available upon request from  https://nvs.landcareresearch.co.nz/Data/DatasetDetails/2424/13248

Therefore, we directly import clean and transformed data object. However, for traceability, we do provide the scripts for importation in the "full data import" folder of the repository. 
```{r data_import_notrun, eval=FALSE, error=TRUE, warning=FALSE, include=FALSE, results='hide'}

# ### Import and clean survey, species and environmental data:
# source('scripts/full data import/import BP species and environment data.R')

# # import GIS data (takes a while as GIS objects are large)
#  source('scripts/full data import/import GIS data.R', echo=FALSE)

# # update envplot to a geospatial object for mapping
# source('scripts/article 2 - Thresholds/modify envplot.R')

# run analyses: 
# source( ##### TO BE FILLED + CORRECTED FOR SMOOTH RUNNING : MASTER SCRIPT ####
# + INCLUDE OUTPUT TO PROVIDE ALL THE FIGURES AND TABLES ###

# load a reduced version of the data:
load("saved Rdata/article 2 - threshold/Bernard-Verdier&Hulme_JEcol2018_data.Rdata")
```

A clean and subsetted version of the data can also be downloaded directly from the online repository *Landcare Research Datastore*: https://doi.org/10.25898/4DG9-F570
But the null models and gamma diversity analyses cannot be performed on these subsetted datasets.

```{r import_online_data}
# 
# library(data.table)
# surveyBP <- fread("https://datastore.landcareresearch.co.nz/dataset/f6f4fc9d-6949-496c-904e-4ab831ec2181/resource/18c47f6a-b2bb-4d6a-bde1-02f9abc3094a/download/vegetation_survey.csv")
# 
# envplotBP <- fread("https://datastore.landcareresearch.co.nz/dataset/f6f4fc9d-6949-496c-904e-4ab831ec2181/resource/703dc9e2-b2ab-428d-96f2-488c70328013/download/envir_variables.csv")
# 
# nomenclatureBP <- fread("https://datastore.landcareresearch.co.nz/dataset/f6f4fc9d-6949-496c-904e-4ab831ec2181/resource/4e7f3d92-64f1-4edd-a686-0214e4d39225/download/nomenclature.csv")
# 
# dim(envplotBP)
# dim(surveyBP)
# length(unique(surveyBP$SpeciesCode))
```


We selected `r length(unimprovedgrasslands)` plots of unimproved grasslands.

```{r map, echo = FALSE}

# Map of land use and selected plots
par(mar=c(0,0,2,2))
plot(region, col = "grey50", border = NA)
polygon(extent(region)[c(1,2,2,1)], 
        extent(region)[c(3,3,4,4)], col ="lightblue", border = NA)
plot(region, add= T, col = "grey70", border = NA)
plot(study_area, add= T, col = "grey90", border = NA)
plot(envplot[envplot$PLOTID %in% unimprovedgrasslands,], add= T,  col ="goldenrod",bg ="goldenrod", pch = 22, cex = 0.7)
```


